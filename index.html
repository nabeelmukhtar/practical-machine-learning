<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.knitr.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
},
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0em 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.rimage.left {
  text-align: left;
}
.rimage.right {
  text-align: right;
}
.rimage.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
<title>Course Project for Practical Machine Learning</title>
</head>
<style type="text/css">
body, td {
font-family: sans-serif;
background-color: white;
font-size: 13px;
}
</style>
<body>
<h1>Course Project: Practical Machine Learning | Coursera</h1>
<h2>Author: Nabeel Mukhtar &lt;nabeelmukhtar@gmail.com&gt;</h2>
<div class="chunk" id="unnamed-chunk-1"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(knitr)</span>
<span class="hl std">opts_chunk</span><span class="hl opt">$</span><span class="hl kwd">set</span><span class="hl std">(</span><span class="hl kwc">fig.width</span><span class="hl std">=</span><span class="hl num">8</span><span class="hl std">,</span> <span class="hl kwc">fig.height</span><span class="hl std">=</span><span class="hl num">8</span><span class="hl std">)</span>
</pre></div>
</div></div>

<p>This is the course project for <a href="https://class.coursera.org/predmachlearn-006">Coursera Practical Machine Learning</a>.
</p>
<p><h3>Objective</h3>
The baseline performance index for this HAR dataset is 99% accuracy (see References). However for the purpose of this assignment we will target an out of sample accuracy of 95% on the testing set.
</p>
<p><h3>Initialization</h3>
Here we initialize random number generator with a seed and load training data. Note that the training data contains #DIV/0! which needs to be parsed as NA.</p>

<div class="chunk" id="initialize"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl kwd">library</span><span class="hl std">(caret)</span>
<span class="hl com">## set seed</span>
<span class="hl kwd">set.seed</span><span class="hl std">(</span><span class="hl num">32343</span><span class="hl std">)</span>
<span class="hl std">wle_data</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">read.csv</span><span class="hl std">(</span><span class="hl str">&quot;data/pml-training.csv&quot;</span><span class="hl std">,</span> <span class="hl kwc">na.strings</span> <span class="hl std">=</span> <span class="hl kwd">c</span><span class="hl std">(</span><span class="hl str">&quot;&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;NA&quot;</span><span class="hl std">,</span> <span class="hl str">&quot;#DIV/0!&quot;</span><span class="hl std">))</span>
</pre></div>
</div></div>

<p>
<h3>Features and Training Parameters</h3>
We decided to use all the predictors for training as using PCA did not result in any improvement. Here we select all predictors that do not contain NAs and are not text/date columns (like user_name/raw_timestamp_part_1 etc). There was no need for removing zero vars because there weren't any in the leftover variables.<br/>
We also initialize training control parameters with 5-fold repeated cross validation for all classifiers.
</p>
<div class="chunk" id="cleanup"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">predictors</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">colnames</span><span class="hl std">(wle_data)</span>
<span class="hl std">predictors</span> <span class="hl kwb">&lt;-</span> <span class="hl std">predictors[</span><span class="hl kwd">colSums</span><span class="hl std">(</span><span class="hl kwd">is.na</span><span class="hl std">(wle_data))</span> <span class="hl opt">==</span> <span class="hl num">0</span><span class="hl std">]</span>
<span class="hl std">predictors</span> <span class="hl kwb">&lt;-</span> <span class="hl std">predictors[</span><span class="hl opt">-</span><span class="hl std">(</span><span class="hl num">1</span><span class="hl opt">:</span><span class="hl num">7</span><span class="hl std">)]</span>
<span class="hl com"># nsv &lt;- nearZeroVar(wle_data[, predictors])</span>
<span class="hl com"># predictors &lt;- predictors[-nsv]</span>
<span class="hl std">classes</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">unique</span><span class="hl std">(wle_data</span><span class="hl opt">$</span><span class="hl std">classe)</span>
<span class="hl std">class_colors</span> <span class="hl kwb">&lt;-</span> <span class="hl num">1</span> <span class="hl opt">+</span> <span class="hl kwd">as.integer</span><span class="hl std">(classes)</span>
<span class="hl std">fitControl</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">trainControl</span><span class="hl std">(</span><span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;repeatedcv&quot;</span><span class="hl std">,</span>
                           <span class="hl kwc">number</span><span class="hl std">=</span><span class="hl num">5</span><span class="hl std">,</span>
                           <span class="hl kwc">repeats</span><span class="hl std">=</span><span class="hl num">1</span><span class="hl std">,</span>
                           <span class="hl kwc">verboseIter</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">)</span>
</pre></div>
</div></div>

<p>
<h3>Data Partitioning</h3>
Here we split the data into into training(49%), testing(21%) and validation(30%) datasets. The validation dataset was used for ensemble classifier in the end.<br/>
Finally we removed unused variables and called gc() to reclaim memory for later analysis.
</p>
<div class="chunk" id="splitting"><div class="rcode"><div class="source"><pre class="knitr r"><span class="hl std">inBuild</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">createDataPartition</span><span class="hl std">(</span><span class="hl kwc">y</span><span class="hl std">=wle_data</span><span class="hl opt">$</span><span class="hl std">classe,</span>
                               <span class="hl kwc">p</span><span class="hl std">=</span><span class="hl num">0.7</span><span class="hl std">,</span> <span class="hl kwc">list</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">)</span>
<span class="hl std">validation</span> <span class="hl kwb">&lt;-</span> <span class="hl std">wle_data[</span><span class="hl opt">-</span><span class="hl std">inBuild, predictors]</span>
<span class="hl std">buildData</span> <span class="hl kwb">&lt;-</span> <span class="hl std">wle_data[inBuild, predictors]</span>
<span class="hl std">inTrain</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">createDataPartition</span><span class="hl std">(</span><span class="hl kwc">y</span><span class="hl std">=buildData</span><span class="hl opt">$</span><span class="hl std">classe,</span>
                               <span class="hl kwc">p</span><span class="hl std">=</span><span class="hl num">0.7</span><span class="hl std">,</span> <span class="hl kwc">list</span><span class="hl std">=</span><span class="hl num">FALSE</span><span class="hl std">)</span>
<span class="hl std">training</span> <span class="hl kwb">&lt;-</span> <span class="hl std">buildData[inTrain, ]</span>
<span class="hl std">testing</span> <span class="hl kwb">&lt;-</span> <span class="hl std">buildData[</span><span class="hl opt">-</span><span class="hl std">inTrain, ]</span>
<span class="hl kwd">rm</span><span class="hl std">(buildData, wle_data, inBuild, inTrain)</span>
<span class="hl std">clean</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">gc</span><span class="hl std">(</span><span class="hl num">FALSE</span><span class="hl std">)</span>
<span class="hl kwd">rm</span><span class="hl std">(clean)</span>
</pre></div>
</div></div>

<p>
<h3>First Attempt: Decision Tree</h3>
The first classifier we tried was a decision tree. The reason is that the model generated by the decision tree is very interpretable and also gives insights on which predictors are more important which is useful for further feature extraction.<br/>
Unfortunately the accuracy of the tree was not very good (56%) on the testing set. We tried different configurations but it did not help much. Here are the tree and results.
</p>
<div class="source"><pre class="knitr r"><span class="hl std">modeltree</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">train</span><span class="hl std">(classe</span> <span class="hl opt">~</span><span class="hl std">.,</span> <span class="hl kwc">data</span><span class="hl std">=training,</span> <span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;rpart&quot;</span><span class="hl std">,</span> <span class="hl kwc">trControl</span><span class="hl std">=fitControl)</span>
<span class="hl kwd">library</span><span class="hl std">(rattle)</span>
<span class="hl kwd">fancyRpartPlot</span><span class="hl std">(modeltree</span><span class="hl opt">$</span><span class="hl std">finalModel)</span>
</pre></div>
</div><div class="rimage center"><img src="figure/tree-1.png" title="plot of chunk tree" alt="plot of chunk tree" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl std">predicttree</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">predict</span><span class="hl std">(modeltree,</span> <span class="hl kwc">newdata</span><span class="hl std">=testing)</span>
<span class="hl std">cmtree</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">confusionMatrix</span><span class="hl std">(predicttree, testing</span><span class="hl opt">$</span><span class="hl std">classe)</span>
<span class="hl kwd">plot</span><span class="hl std">(cmtree</span><span class="hl opt">$</span><span class="hl std">table,</span> <span class="hl kwc">col</span> <span class="hl std">= class_colors,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Decision Tree Confusion Matrix: Accuracy=&quot;</span><span class="hl std">,</span> <span class="hl kwd">round</span><span class="hl std">(cmtree</span><span class="hl opt">$</span><span class="hl std">overall[</span><span class="hl str">'Accuracy'</span><span class="hl std">],</span> <span class="hl num">2</span><span class="hl std">)))</span>
</pre></div>
</div><div class="rimage center"><img src="figure/tree-2.png" title="plot of chunk tree" alt="plot of chunk tree" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">kable</span><span class="hl std">(cmtree</span><span class="hl opt">$</span><span class="hl std">byClass,</span> <span class="hl kwc">digits</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">caption</span> <span class="hl std">=</span> <span class="hl str">&quot;Per Class Metrics&quot;</span><span class="hl std">)</span>
</pre></div>
<table>
<caption>Per Class Metrics</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Sensitivity </th>
   <th style="text-align:right;"> Specificity </th>
   <th style="text-align:right;"> Pos Pred Value </th>
   <th style="text-align:right;"> Neg Pred Value </th>
   <th style="text-align:right;"> Prevalence </th>
   <th style="text-align:right;"> Detection Rate </th>
   <th style="text-align:right;"> Detection Prevalence </th>
   <th style="text-align:right;"> Balanced Accuracy </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Class: A </td>
   <td style="text-align:right;"> 0.62 </td>
   <td style="text-align:right;"> 0.96 </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.20 </td>
   <td style="text-align:right;"> 0.79 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: B </td>
   <td style="text-align:right;"> 0.46 </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> 0.46 </td>
   <td style="text-align:right;"> 0.87 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.09 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.66 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: C </td>
   <td style="text-align:right;"> 0.77 </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> 0.51 </td>
   <td style="text-align:right;"> 0.94 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.26 </td>
   <td style="text-align:right;"> 0.80 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: D </td>
   <td style="text-align:right;"> 0.49 </td>
   <td style="text-align:right;"> 0.78 </td>
   <td style="text-align:right;"> 0.31 </td>
   <td style="text-align:right;"> 0.89 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.08 </td>
   <td style="text-align:right;"> 0.26 </td>
   <td style="text-align:right;"> 0.63 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: E </td>
   <td style="text-align:right;"> 0.43 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 0.89 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.08 </td>
   <td style="text-align:right;"> 0.08 </td>
   <td style="text-align:right;"> 0.71 </td>
  </tr>
</tbody>
</table>


<p>
<h3>Second Attempt: Linear Discriminant Analysis</h3>
The second classifier we tried was an LDA classifier which was also taught in the course. We chose the default parameters with a 5 fold cross validation. The accuracy was vastly improved to 71% but it was still not very good. Here are the results.
</p>
<div class="source"><pre class="knitr r"><span class="hl std">modellda</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">train</span><span class="hl std">(classe</span> <span class="hl opt">~</span><span class="hl std">.,</span> <span class="hl kwc">data</span><span class="hl std">=training,</span> <span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;lda&quot;</span><span class="hl std">,</span> <span class="hl kwc">trControl</span><span class="hl std">=fitControl)</span>
<span class="hl std">predictlda</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">predict</span><span class="hl std">(modellda,</span> <span class="hl kwc">newdata</span><span class="hl std">=testing)</span>
<span class="hl std">cmlda</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">confusionMatrix</span><span class="hl std">(predictlda, testing</span><span class="hl opt">$</span><span class="hl std">classe)</span>
<span class="hl kwd">plot</span><span class="hl std">(cmlda</span><span class="hl opt">$</span><span class="hl std">table,</span> <span class="hl kwc">col</span> <span class="hl std">= class_colors,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;LDA Confusion Matrix: Accuracy=&quot;</span><span class="hl std">,</span> <span class="hl kwd">round</span><span class="hl std">(cmlda</span><span class="hl opt">$</span><span class="hl std">overall[</span><span class="hl str">'Accuracy'</span><span class="hl std">],</span> <span class="hl num">2</span><span class="hl std">)))</span>
</pre></div>
</div><div class="rimage center"><img src="figure/lda-1.png" title="plot of chunk lda" alt="plot of chunk lda" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">kable</span><span class="hl std">(cmlda</span><span class="hl opt">$</span><span class="hl std">byClass,</span> <span class="hl kwc">digits</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">caption</span> <span class="hl std">=</span> <span class="hl str">&quot;Per Class Metrics&quot;</span><span class="hl std">)</span>
</pre></div>
<table>
<caption>Per Class Metrics</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Sensitivity </th>
   <th style="text-align:right;"> Specificity </th>
   <th style="text-align:right;"> Pos Pred Value </th>
   <th style="text-align:right;"> Neg Pred Value </th>
   <th style="text-align:right;"> Prevalence </th>
   <th style="text-align:right;"> Detection Rate </th>
   <th style="text-align:right;"> Detection Prevalence </th>
   <th style="text-align:right;"> Balanced Accuracy </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Class: A </td>
   <td style="text-align:right;"> 0.84 </td>
   <td style="text-align:right;"> 0.91 </td>
   <td style="text-align:right;"> 0.79 </td>
   <td style="text-align:right;"> 0.93 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.24 </td>
   <td style="text-align:right;"> 0.30 </td>
   <td style="text-align:right;"> 0.87 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: B </td>
   <td style="text-align:right;"> 0.65 </td>
   <td style="text-align:right;"> 0.93 </td>
   <td style="text-align:right;"> 0.70 </td>
   <td style="text-align:right;"> 0.92 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.79 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: C </td>
   <td style="text-align:right;"> 0.68 </td>
   <td style="text-align:right;"> 0.90 </td>
   <td style="text-align:right;"> 0.59 </td>
   <td style="text-align:right;"> 0.93 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.12 </td>
   <td style="text-align:right;"> 0.20 </td>
   <td style="text-align:right;"> 0.79 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: D </td>
   <td style="text-align:right;"> 0.71 </td>
   <td style="text-align:right;"> 0.92 </td>
   <td style="text-align:right;"> 0.64 </td>
   <td style="text-align:right;"> 0.94 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.12 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.82 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: E </td>
   <td style="text-align:right;"> 0.62 </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 0.86 </td>
   <td style="text-align:right;"> 0.92 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.11 </td>
   <td style="text-align:right;"> 0.13 </td>
   <td style="text-align:right;"> 0.80 </td>
  </tr>
</tbody>
</table>


<p>
<h3>Third Attempt: Generalized Boosted Regression Modeling</h3>
Finally we stumbled upon the GBM classifier. We ran it with repeated cross validation and its accuracy was much better (96%) on the training set even though it took much longer to execute.
</p>
<div class="source"><pre class="knitr r"><span class="hl std">modelgbm</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">train</span><span class="hl std">(classe</span> <span class="hl opt">~</span><span class="hl std">.,</span> <span class="hl kwc">data</span><span class="hl std">=training,</span> <span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;gbm&quot;</span><span class="hl std">,</span> <span class="hl kwc">trControl</span><span class="hl std">=fitControl,</span> <span class="hl kwc">verbose</span> <span class="hl std">=</span> <span class="hl num">FALSE</span><span class="hl std">)</span>
<span class="hl std">predictgbm</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">predict</span><span class="hl std">(modelgbm,</span> <span class="hl kwc">newdata</span><span class="hl std">=testing)</span>
<span class="hl std">cmgbm</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">confusionMatrix</span><span class="hl std">(predictgbm, testing</span><span class="hl opt">$</span><span class="hl std">classe)</span>
<span class="hl kwd">plot</span><span class="hl std">(cmgbm</span><span class="hl opt">$</span><span class="hl std">table,</span> <span class="hl kwc">col</span> <span class="hl std">= class_colors,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;GBM Confusion Matrix: Accuracy=&quot;</span><span class="hl std">,</span> <span class="hl kwd">round</span><span class="hl std">(cmgbm</span><span class="hl opt">$</span><span class="hl std">overall[</span><span class="hl str">'Accuracy'</span><span class="hl std">],</span> <span class="hl num">2</span><span class="hl std">)))</span>
</pre></div>
</div><div class="rimage center"><img src="figure/gbm-1.png" title="plot of chunk gbm" alt="plot of chunk gbm" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">kable</span><span class="hl std">(cmgbm</span><span class="hl opt">$</span><span class="hl std">byClass,</span> <span class="hl kwc">digits</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">caption</span> <span class="hl std">=</span> <span class="hl str">&quot;Per Class Metrics&quot;</span><span class="hl std">)</span>
</pre></div>
<table>
<caption>Per Class Metrics</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Sensitivity </th>
   <th style="text-align:right;"> Specificity </th>
   <th style="text-align:right;"> Pos Pred Value </th>
   <th style="text-align:right;"> Neg Pred Value </th>
   <th style="text-align:right;"> Prevalence </th>
   <th style="text-align:right;"> Detection Rate </th>
   <th style="text-align:right;"> Detection Prevalence </th>
   <th style="text-align:right;"> Balanced Accuracy </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Class: A </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.29 </td>
   <td style="text-align:right;"> 0.99 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: B </td>
   <td style="text-align:right;"> 0.94 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.95 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.97 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: C </td>
   <td style="text-align:right;"> 0.97 </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 0.93 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.98 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: D </td>
   <td style="text-align:right;"> 0.95 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.96 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.97 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: E </td>
   <td style="text-align:right;"> 0.95 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.97 </td>
  </tr>
</tbody>
</table>


<p>
<h3>Final Attempt: Ensemble Classifier</h3>
Moving on we decided to build an ensemble of the first three classifiers by stacking them with random forest to see if it further improves the accuracy. Unfortunately the accuracy was still 96% with a slight improvement in the accuracy of class E.
</p>
<div class="source"><pre class="knitr r"><span class="hl std">predicttesting</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">data.frame</span><span class="hl std">(predicttree, predictgbm, predictlda,</span> <span class="hl kwc">classe</span> <span class="hl std">= testing</span><span class="hl opt">$</span><span class="hl std">classe)</span>
<span class="hl std">modelensemble</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">train</span><span class="hl std">(classe</span> <span class="hl opt">~</span> <span class="hl std">.,</span> <span class="hl kwc">data</span> <span class="hl std">= predicttesting,</span> <span class="hl kwc">method</span> <span class="hl std">=</span> <span class="hl str">&quot;rf&quot;</span><span class="hl std">)</span>
<span class="hl std">predictvalidation</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">data.frame</span><span class="hl std">(</span><span class="hl kwc">predicttree</span> <span class="hl std">=</span> <span class="hl kwd">predict</span><span class="hl std">(modeltree,</span> <span class="hl kwc">newdata</span><span class="hl std">=validation),</span>
                                <span class="hl kwc">predictgbm</span> <span class="hl std">=</span> <span class="hl kwd">predict</span><span class="hl std">(modelgbm,</span> <span class="hl kwc">newdata</span><span class="hl std">=validation),</span>
                                <span class="hl kwc">predictlda</span> <span class="hl std">=</span> <span class="hl kwd">predict</span><span class="hl std">(modellda,</span> <span class="hl kwc">newdata</span><span class="hl std">=validation),</span>
                                <span class="hl kwc">classe</span> <span class="hl std">= validation</span><span class="hl opt">$</span><span class="hl std">classe)</span>
<span class="hl std">predictensemble</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">predict</span><span class="hl std">(modelensemble, predictvalidation)</span>
<span class="hl std">cmensemble</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">confusionMatrix</span><span class="hl std">(predictensemble, validation</span><span class="hl opt">$</span><span class="hl std">classe)</span>
<span class="hl kwd">plot</span><span class="hl std">(cmensemble</span><span class="hl opt">$</span><span class="hl std">table,</span> <span class="hl kwc">col</span> <span class="hl std">= class_colors,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Ensemble Confusion Matrix: Accuracy=&quot;</span><span class="hl std">,</span> <span class="hl kwd">round</span><span class="hl std">(cmensemble</span><span class="hl opt">$</span><span class="hl std">overall[</span><span class="hl str">'Accuracy'</span><span class="hl std">],</span> <span class="hl num">2</span><span class="hl std">)))</span>
</pre></div>
</div><div class="rimage center"><img src="figure/ensemble-1.png" title="plot of chunk ensemble" alt="plot of chunk ensemble" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">kable</span><span class="hl std">(cmensemble</span><span class="hl opt">$</span><span class="hl std">byClass,</span> <span class="hl kwc">digits</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">caption</span> <span class="hl std">=</span> <span class="hl str">&quot;Per Class Metrics&quot;</span><span class="hl std">)</span>
</pre></div>
<table>
<caption>Per Class Metrics</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Sensitivity </th>
   <th style="text-align:right;"> Specificity </th>
   <th style="text-align:right;"> Pos Pred Value </th>
   <th style="text-align:right;"> Neg Pred Value </th>
   <th style="text-align:right;"> Prevalence </th>
   <th style="text-align:right;"> Detection Rate </th>
   <th style="text-align:right;"> Detection Prevalence </th>
   <th style="text-align:right;"> Balanced Accuracy </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Class: A </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.99 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: B </td>
   <td style="text-align:right;"> 0.95 </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 0.94 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.20 </td>
   <td style="text-align:right;"> 0.97 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: C </td>
   <td style="text-align:right;"> 0.96 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.93 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.97 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: D </td>
   <td style="text-align:right;"> 0.95 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.97 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.97 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: E </td>
   <td style="text-align:right;"> 0.97 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.98 </td>
  </tr>
</tbody>
</table>


<p>
<h3>Even Better Attempt: Random Forest</h3>
We had tried random forest initially but could not make it complete in a reasonable amount of time. After evaluating some assignments we realized that a random forest would have been an even more accurate classifier and would finish in reasonable time if we do proper feature selection and limit the number of trees to 100. Here's another attempt with the best accuracy of 98%.
</p>
<div class="source"><pre class="knitr r"><span class="hl std">modelrf</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">train</span><span class="hl std">(classe</span> <span class="hl opt">~</span> <span class="hl std">roll_belt</span> <span class="hl opt">+</span> <span class="hl std">pitch_forearm</span> <span class="hl opt">+</span> <span class="hl std">magnet_dumbbell_z</span> <span class="hl opt">+</span> <span class="hl std">yaw_belt</span> <span class="hl opt">+</span> <span class="hl std">magnet_dumbbell_y</span> <span class="hl opt">+</span> <span class="hl std">roll_forearm</span> <span class="hl opt">+</span> <span class="hl std">pitch_belt,</span> <span class="hl kwc">data</span><span class="hl std">=training,</span> <span class="hl kwc">method</span><span class="hl std">=</span><span class="hl str">&quot;rf&quot;</span><span class="hl std">,</span> <span class="hl kwc">ntree</span> <span class="hl std">=</span> <span class="hl num">100</span><span class="hl std">)</span>
<span class="hl std">predictrf</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">predict</span><span class="hl std">(modelrf,</span> <span class="hl kwc">newdata</span><span class="hl std">=testing)</span>
<span class="hl std">cmrf</span> <span class="hl kwb">&lt;-</span> <span class="hl kwd">confusionMatrix</span><span class="hl std">(predictrf, testing</span><span class="hl opt">$</span><span class="hl std">classe)</span>
<span class="hl kwd">plot</span><span class="hl std">(cmrf</span><span class="hl opt">$</span><span class="hl std">table,</span> <span class="hl kwc">col</span> <span class="hl std">= class_colors,</span> <span class="hl kwc">main</span> <span class="hl std">=</span> <span class="hl kwd">paste</span><span class="hl std">(</span><span class="hl str">&quot;Random Forest Confusion Matrix: Accuracy=&quot;</span><span class="hl std">,</span> <span class="hl kwd">round</span><span class="hl std">(cmrf</span><span class="hl opt">$</span><span class="hl std">overall[</span><span class="hl str">'Accuracy'</span><span class="hl std">],</span> <span class="hl num">2</span><span class="hl std">)))</span>
</pre></div>
</div><div class="rimage center"><img src="figure/rf-1.png" title="plot of chunk rf" alt="plot of chunk rf" class="plot" /></div><div class="rcode">
<div class="source"><pre class="knitr r"><span class="hl kwd">kable</span><span class="hl std">(cmrf</span><span class="hl opt">$</span><span class="hl std">byClass,</span> <span class="hl kwc">digits</span> <span class="hl std">=</span> <span class="hl num">2</span><span class="hl std">,</span> <span class="hl kwc">caption</span> <span class="hl std">=</span> <span class="hl str">&quot;Per Class Metrics&quot;</span><span class="hl std">)</span>
</pre></div>
<table>
<caption>Per Class Metrics</caption>
 <thead>
  <tr>
   <th style="text-align:left;">   </th>
   <th style="text-align:right;"> Sensitivity </th>
   <th style="text-align:right;"> Specificity </th>
   <th style="text-align:right;"> Pos Pred Value </th>
   <th style="text-align:right;"> Neg Pred Value </th>
   <th style="text-align:right;"> Prevalence </th>
   <th style="text-align:right;"> Detection Rate </th>
   <th style="text-align:right;"> Detection Prevalence </th>
   <th style="text-align:right;"> Balanced Accuracy </th>
  </tr>
 </thead>
<tbody>
  <tr>
   <td style="text-align:left;"> Class: A </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.28 </td>
   <td style="text-align:right;"> 0.99 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: B </td>
   <td style="text-align:right;"> 0.96 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.19 </td>
   <td style="text-align:right;"> 0.98 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: C </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 0.96 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.99 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: D </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.16 </td>
   <td style="text-align:right;"> 0.17 </td>
   <td style="text-align:right;"> 0.99 </td>
  </tr>
  <tr>
   <td style="text-align:left;"> Class: E </td>
   <td style="text-align:right;"> 0.98 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 0.99 </td>
   <td style="text-align:right;"> 1.00 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.18 </td>
   <td style="text-align:right;"> 0.99 </td>
  </tr>
</tbody>
</table>


<p>
<h3>Conclusion</h3>
Since the ensemble classifier could not improve the accuracy of the classifiers probably because the accuracies of the LDA and Descision Tree were much less than GBM. So in the end we decided to go with the GBM classifier which has the best accuracy of 96%. Alas we could not evaluate random forest before the assignment deadline.
</p>
<p>
<h3>References</h3>
Velloso, E.; Bulling, A.; Gellersen, H.; Ugulino, W.; Fuks, H. Qualitative Activity Recognition of Weight Lifting Exercises. Proceedings of 4th International Conference in Cooperation with SIGCHI (Augmented Human '13) . Stuttgart, Germany: ACM SIGCHI, 2013.

Read more: http://groupware.les.inf.puc-rio.br/har#weight_lifting_exercises#ixzz3Gx4pWyLd
</p>
</body>
</html>
